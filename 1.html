<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#dc2626">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">

    <title>YT Downloader Pro - 4K Video Downloads</title>

    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary-color: #dc2626;
            --primary-dark: #b91c1c;
            --secondary-color: #1f2937;
            --accent-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --gradient-primary: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            --gradient-secondary: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }

        .hero-section {
            background: var(--gradient-primary);
            padding: 2rem 0;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><circle cx="50" cy="50" r="50" fill="url(%23g)"/></svg>');
            opacity: 0.1;
            animation: pulse 4s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.1;
            }

            100% {
                transform: scale(1.05);
                opacity: 0.2;
            }
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: var(--shadow-xl);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 800px;
            position: relative;
            overflow: hidden;
        }

        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .input-group-modern {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .input-modern {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .input-modern:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
            transform: translateY(-2px);
        }

        .btn-modern {
            padding: 1rem 2rem;
            border: none;
            border-radius: 16px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-height: 48px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -5px rgba(220, 38, 38, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .quality-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            margin: 1.5rem 0;
        }

        .quality-option {
            position: relative;
        }

        .quality-radio {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .quality-label {
            display: block;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .quality-label:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .quality-radio:checked+.quality-label {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .video-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .video-thumbnail {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            backdrop-filter: blur(10px);
        }

        .progress-bar-container {
            background: #e5e7eb;
            border-radius: 12px;
            height: 12px;
            overflow: hidden;
            margin: 1rem 0;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 12px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(200%);
            }
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-downloading {
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent-color);
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .floating-action {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        .toast-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 10000;
            max-width: 400px;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-lg);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--error-color);
        }

        .toast-info {
            border-left: 4px solid var(--accent-color);
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .hero-section {
                padding: 1.5rem 0;
            }

            .main-card {
                margin: 1rem;
                padding: 1.5rem;
                border-radius: 20px;
            }

            .quality-selector {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            .quality-label {
                padding: 0.625rem 0.75rem;
                font-size: 0.875rem;
            }

            .btn-modern {
                padding: 0.875rem 1.5rem;
                font-size: 0.925rem;
            }

            .floating-action {
                bottom: 1rem;
                right: 1rem;
            }

            .toast-container {
                top: 1rem;
                right: 1rem;
                left: 1rem;
                max-width: none;
            }

            .video-info {
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .quality-selector {
                grid-template-columns: 1fr;
            }

            .main-card {
                margin: 0.5rem;
                padding: 1rem;
            }
        }

        /* Performance optimizations */
        .will-change-transform {
            will-change: transform;
        }

        .gpu-accelerated {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .main-card {
                background: rgba(31, 41, 55, 0.95);
                color: #f9fafb;
            }

            .input-modern {
                background: rgba(55, 65, 81, 0.9);
                color: #f9fafb;
                border-color: #4b5563;
            }

            .video-info,
            .progress-container {
                background: rgba(55, 65, 81, 0.9);
                color: #f9fafb;
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus indicators for keyboard navigation */
        .btn-modern:focus-visible,
        .quality-label:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content text-center text-white">
                    <h1 class="display-4 fw-bold mb-3">
                        <i class="fab fa-youtube text-red-500"></i>
                        YT Downloader Pro
                    </h1>
                    <p class="lead mb-4">Download YouTube videos in 4K quality with premium audio</p>
                    <div class="d-flex justify-content-center gap-4 flex-wrap">
                        <span class="badge bg-light text-dark px-3 py-2 rounded-pill">
                            <i class="fas fa-video me-1"></i> Up to 4K Quality
                        </span>
                        <span class="badge bg-light text-dark px-3 py-2 rounded-pill">
                            <i class="fas fa-music me-1"></i> Premium Audio
                        </span>
                        <span class="badge bg-light text-dark px-3 py-2 rounded-pill">
                            <i class="fas fa-mobile-alt me-1"></i> Mobile Optimized
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="flex-grow-1">
            <div class="container">
                <div class="main-card gpu-accelerated">
                    <!-- URL Input Section -->
                    <div class="mb-4">
                        <label for="videoUrl" class="form-label fw-semibold text-lg mb-3">
                            <i class="fas fa-link me-2 text-primary"></i>
                            Video URL
                        </label>
                        <div class="input-group-modern">
                            <input type="url" id="videoUrl" class="input-modern"
                                placeholder="Paste YouTube video URL here..." aria-label="YouTube video URL"
                                autocomplete="off" spellcheck="false">
                        </div>
                        <button id="getInfoBtn" class="btn-modern btn-secondary will-change-transform" type="button">
                            <i class="fas fa-info-circle"></i>
                            Get Video Info
                        </button>
                    </div>

                    <!-- Video Information -->
                    <div id="videoInfo" class="video-info d-none">
                        <div class="row align-items-center">
                            <div class="col-md-4 text-center mb-3 mb-md-0">
                                <img id="videoThumbnail" src="" alt="Video thumbnail" class="video-thumbnail">
                            </div>
                            <div class="col-md-8">
                                <h4 id="videoTitle" class="fw-bold mb-2"></h4>
                                <p class="text-muted mb-2">
                                    <i class="fas fa-user me-1"></i>
                                    <span id="videoUploader"></span>
                                </p>
                                <div class="d-flex flex-wrap gap-3 mb-3">
                                    <span class="text-sm">
                                        <i class="fas fa-clock me-1"></i>
                                        <span id="videoDuration"></span>
                                    </span>
                                    <span class="text-sm">
                                        <i class="fas fa-eye me-1"></i>
                                        <span id="videoViews"></span>
                                    </span>
                                    <span class="text-sm">
                                        <i class="fas fa-calendar me-1"></i>
                                        <span id="videoDate"></span>
                                    </span>
                                </div>
                                <p id="videoDescription" class="text-sm text-muted"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Quality Selection -->
                    <div id="qualitySection" class="d-none">
                        <label class="form-label fw-semibold text-lg mb-3">
                            <i class="fas fa-sliders-h me-2 text-primary"></i>
                            Quality Selection
                        </label>
                        <div class="quality-selector">
                            <div class="quality-option">
                                <input type="radio" id="quality_4k" name="quality" value="4k" class="quality-radio">
                                <label for="quality_4k" class="quality-label gpu-accelerated">
                                    <i class="fas fa-crown mb-1 d-block text-warning"></i>
                                    4K Ultra
                                </label>
                            </div>
                            <div class="quality-option">
                                <input type="radio" id="quality_best" name="quality" value="best" class="quality-radio"
                                    checked>
                                <label for="quality_best" class="quality-label gpu-accelerated">
                                    <i class="fas fa-star mb-1 d-block text-success"></i>
                                    Best Quality
                                </label>
                            </div>
                            <div class="quality-option">
                                <input type="radio" id="quality_1080p" name="quality" value="1080p"
                                    class="quality-radio">
                                <label for="quality_1080p" class="quality-label gpu-accelerated">
                                    <i class="fas fa-hd-video mb-1 d-block"></i>
                                    1080p HD
                                </label>
                            </div>
                            <div class="quality-option">
                                <input type="radio" id="quality_720p" name="quality" value="720p" class="quality-radio">
                                <label for="quality_720p" class="quality-label gpu-accelerated">
                                    <i class="fas fa-film mb-1 d-block"></i>
                                    720p HD
                                </label>
                            </div>
                            <div class="quality-option">
                                <input type="radio" id="quality_480p" name="quality" value="480p" class="quality-radio">
                                <label for="quality_480p" class="quality-label gpu-accelerated">
                                    <i class="fas fa-video mb-1 d-block"></i>
                                    480p SD
                                </label>
                            </div>
                            <div class="quality-option">
                                <input type="radio" id="quality_audio" name="quality" value="audio"
                                    class="quality-radio">
                                <label for="quality_audio" class="quality-label gpu-accelerated">
                                    <i class="fas fa-music mb-1 d-block text-purple-500"></i>
                                    Audio Only
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Download Button -->
                    <div id="downloadSection" class="text-center d-none">
                        <button id="downloadBtn" class="btn-modern btn-primary will-change-transform" type="button">
                            <i class="fas fa-download"></i>
                            Start Download
                        </button>
                    </div>

                    <!-- Progress Section -->
                    <div id="progressSection" class="progress-container d-none">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Download Progress</h5>
                            <div id="downloadStatus" class="status-indicator">
                                <div class="spinner"></div>
                                Initializing...
                            </div>
                        </div>

                        <div class="progress-bar-container">
                            <div id="progressBar" class="progress-bar" style="width: 0%"></div>
                        </div>

                        <div class="row text-sm text-muted mt-3">
                            <div class="col-6">
                                <i class="fas fa-percentage me-1"></i>
                                Progress: <span id="progressPercent">0%</span>
                            </div>
                            <div class="col-6 text-end">
                                <i class="fas fa-clock me-1"></i>
                                ETA: <span id="progressETA">--</span>
                            </div>
                        </div>

                        <div class="row text-sm text-muted mt-2">
                            <div class="col-6">
                                <i class="fas fa-tachometer-alt me-1"></i>
                                Speed: <span id="progressSpeed">--</span>
                            </div>
                            <div class="col-6 text-end">
                                <i class="fas fa-hdd me-1"></i>
                                Size: <span id="progressSize">--</span>
                            </div>
                        </div>

                        <div id="downloadCompleted" class="text-center mt-4 d-none">
                            <button id="downloadFileBtn" class="btn-modern btn-primary will-change-transform">
                                <i class="fas fa-file-download"></i>
                                Download File
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Floating Action Button -->
        <div class="floating-action">
            <button id="scrollTopBtn" class="fab d-none" title="Scroll to top">
                <i class="fas fa-arrow-up"></i>
            </button>
        </div>

        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <script>
        class YouTubeDownloader {
            constructor() {
                this.apiUrl = 'http://127.0.0.1:5000'; // Replace with your Render URL
                this.currentDownloadId = null;
                this.progressInterval = null;

                this.initializeElements();
                this.bindEvents();
                this.setupPerformanceOptimizations();
            }

            initializeElements() {
                this.elements = {
                    urlInput: document.getElementById('videoUrl'),
                    getInfoBtn: document.getElementById('getInfoBtn'),
                    downloadBtn: document.getElementById('downloadBtn'),
                    downloadFileBtn: document.getElementById('downloadFileBtn'),
                    scrollTopBtn: document.getElementById('scrollTopBtn'),

                    videoInfo: document.getElementById('videoInfo'),
                    qualitySection: document.getElementById('qualitySection'),
                    downloadSection: document.getElementById('downloadSection'),
                    progressSection: document.getElementById('progressSection'),
                    downloadCompleted: document.getElementById('downloadCompleted'),

                    videoThumbnail: document.getElementById('videoThumbnail'),
                    videoTitle: document.getElementById('videoTitle'),
                    videoUploader: document.getElementById('videoUploader'),
                    videoDuration: document.getElementById('videoDuration'),
                    videoViews: document.getElementById('videoViews'),
                    videoDate: document.getElementById('videoDate'),
                    videoDescription: document.getElementById('videoDescription'),

                    progressBar: document.getElementById('progressBar'),
                    downloadStatus: document.getElementById('downloadStatus'),
                    progressPercent: document.getElementById('progressPercent'),
                    progressETA: document.getElementById('progressETA'),
                    progressSpeed: document.getElementById('progressSpeed'),
                    progressSize: document.getElementById('progressSize'),

                    toastContainer: document.getElementById('toastContainer')
                };
            }

            bindEvents() {
                this.elements.getInfoBtn.addEventListener('click', () => this.getVideoInfo());
                this.elements.downloadBtn.addEventListener('click', () => this.startDownload());
                this.elements.downloadFileBtn.addEventListener('click', () => this.downloadFile());
                this.elements.scrollTopBtn.addEventListener('click', () => this.scrollToTop());

                this.elements.urlInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.getVideoInfo();
                    }
                });

                this.elements.urlInput.addEventListener('paste', () => {
                    setTimeout(() => this.getVideoInfo(), 100);
                });

                window.addEventListener('scroll', this.throttle(() => {
                    this.handleScroll();
                }, 100));
            }

            setupPerformanceOptimizations() {
                // Preload critical resources
                if ('serviceWorker' in navigator) {
                    this.registerServiceWorker();
                }

                // Enable hardware acceleration for animations
                document.querySelectorAll('.will-change-transform').forEach(el => {
                    el.style.willChange = 'transform';
                });
            }

            async registerServiceWorker() {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('ServiceWorker registered:', registration);
                } catch (error) {
                    console.log('ServiceWorker registration failed:', error);
                }
            }

            throttle(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            handleScroll() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (scrollTop > 300) {
                    this.elements.scrollTopBtn.classList.remove('d-none');
                } else {
                    this.elements.scrollTopBtn.classList.add('d-none');
                }
            }

            scrollToTop() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }

            showToast(message, type = 'info', duration = 5000) {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-${this.getToastIcon(type)} me-2"></i>
                        <span class="flex-grow-1">${message}</span>
                        <button type="button" class="btn-close btn-close-sm ms-2" onclick="this.parentElement.parentElement.remove()"></button>
                    </div>
                `;

                this.elements.toastContainer.appendChild(toast);

                requestAnimationFrame(() => {
                    toast.classList.add('show');
                });

                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }

            getToastIcon(type) {
                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-triangle',
                    info: 'info-circle',
                    warning: 'exclamation-circle'
                };
                return icons[type] || 'info-circle';
            }

            async makeRequest(endpoint, options = {}) {
                try {
                    const response = await fetch(`${this.apiUrl}${endpoint}`, {
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        ...options
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return await response.json();
                } catch (error) {
                    console.error('Request failed:', error);
                    throw error;
                }
            }

            async getVideoInfo() {
                const url = this.elements.urlInput.value.trim();

                if (!url) {
                    this.showToast('Please enter a YouTube URL', 'warning');
                    return;
                }

                if (!this.isValidYouTubeUrl(url)) {
                    this.showToast('Please enter a valid YouTube URL', 'error');
                    return;
                }

                this.setLoadingState(this.elements.getInfoBtn, true);
                this.hideAllSections();

                try {
                    const response = await this.makeRequest('/api/info', {
                        method: 'POST',
                        body: JSON.stringify({ url })
                    });

                    if (response.success) {
                        this.displayVideoInfo(response.data);
                        this.showQualitySelection();
                        this.showToast('Video information loaded successfully!', 'success');
                    } else {
                        throw new Error(response.error || 'Failed to get video info');
                    }
                } catch (error) {
                    this.showToast(`Error: ${error.message}`, 'error');
                } finally {
                    this.setLoadingState(this.elements.getInfoBtn, false);
                }
            }

            isValidYouTubeUrl(url) {
                const patterns = [
                    /^https?:\/\/(www\.)?youtube\.com\/watch\?v=[\w-]+/,
                    /^https?:\/\/(www\.)?youtu\.be\/[\w-]+/,
                    /^https?:\/\/(www\.)?youtube\.com\/embed\/[\w-]+/,
                    /^https?:\/\/(www\.)?m\.youtube\.com\/watch\?v=[\w-]+/
                ];
                return patterns.some(pattern => pattern.test(url));
            }

            displayVideoInfo(info) {
                this.elements.videoThumbnail.src = info.thumbnail;
                this.elements.videoThumbnail.alt = info.title;
                this.elements.videoTitle.textContent = info.title;
                this.elements.videoUploader.textContent = info.uploader;
                this.elements.videoDuration.textContent = this.formatDuration(info.duration);
                this.elements.videoViews.textContent = this.formatNumber(info.view_count);
                this.elements.videoDate.textContent = this.formatDate(info.upload_date);
                this.elements.videoDescription.textContent = info.description;

                this.elements.videoInfo.classList.remove('d-none');
            }

            showQualitySelection() {
                this.elements.qualitySection.classList.remove('d-none');
                this.elements.downloadSection.classList.remove('d-none');
            }

            hideAllSections() {
                this.elements.videoInfo.classList.add('d-none');
                this.elements.qualitySection.classList.add('d-none');
                this.elements.downloadSection.classList.add('d-none');
                this.elements.progressSection.classList.add('d-none');
                this.elements.downloadCompleted.classList.add('d-none');
            }

            async startDownload() {
                const url = this.elements.urlInput.value.trim();
                const quality = document.querySelector('input[name="quality"]:checked').value;

                this.setLoadingState(this.elements.downloadBtn, true);

                try {
                    const response = await this.makeRequest('/api/download', {
                        method: 'POST',
                        body: JSON.stringify({ url, quality })
                    });

                    if (response.success) {
                        this.currentDownloadId = response.download_id;
                        this.showProgressSection();
                        this.startProgressTracking();
                        this.showToast('Download started successfully!', 'success');
                    } else {
                        throw new Error(response.error || 'Failed to start download');
                    }
                } catch (error) {
                    this.showToast(`Error: ${error.message}`, 'error');
                } finally {
                    this.setLoadingState(this.elements.downloadBtn, false);
                }
            }

            showProgressSection() {
                this.elements.progressSection.classList.remove('d-none');
                this.elements.progressSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            startProgressTracking() {
                if (this.progressInterval) {
                    clearInterval(this.progressInterval);
                }

                this.progressInterval = setInterval(() => {
                    this.updateProgress();
                }, 1000);
            }

            async updateProgress() {
                if (!this.currentDownloadId) return;

                try {
                    const response = await this.makeRequest(`/api/status/${this.currentDownloadId}`);

                    if (response.success) {
                        this.updateProgressDisplay(response.status);

                        if (response.status.status === 'completed') {
                            this.handleDownloadComplete();
                        } else if (response.status.status === 'error') {
                            this.handleDownloadError(response.status.message);
                        }
                    }
                } catch (error) {
                    console.error('Progress update failed:', error);
                }
            }

            updateProgressDisplay(status) {
                const progress = status.progress || 0;
                this.elements.progressBar.style.width = `${progress}%`;
                this.elements.progressPercent.textContent = `${progress.toFixed(1)}%`;

                this.elements.progressETA.textContent = status.eta ?
                    this.formatTime(status.eta) : '--';
                this.elements.progressSpeed.textContent = status.speed ?
                    this.formatBytes(status.speed) + '/s' : '--';
                this.elements.progressSize.textContent = status.total_bytes ?
                    this.formatBytes(status.total_bytes) : '--';

                this.updateStatusIndicator(status.status, status.message);
            }

            updateStatusIndicator(status, message) {
                const statusElement = this.elements.downloadStatus;
                statusElement.className = `status-indicator status-${status}`;

                const icons = {
                    downloading: '<div class="spinner"></div>',
                    processing: '<div class="spinner"></div>',
                    completed: '<i class="fas fa-check-circle"></i>',
                    error: '<i class="fas fa-exclamation-triangle"></i>'
                };

                const messages = {
                    downloading: 'Downloading...',
                    processing: 'Processing...',
                    completed: 'Completed!',
                    error: 'Error occurred'
                };

                statusElement.innerHTML = `
                    ${icons[status] || '<div class="spinner"></div>'}
                    ${message || messages[status] || 'Unknown status'}
                `;
            }

            handleDownloadComplete() {
                clearInterval(this.progressInterval);
                this.elements.downloadCompleted.classList.remove('d-none');
                this.showToast('Download completed successfully!', 'success');
            }

            handleDownloadError(message) {
                clearInterval(this.progressInterval);
                this.showToast(`Download failed: ${message}`, 'error');
            }

            async downloadFile() {
                if (!this.currentDownloadId) return;

                try {
                    const response = await fetch(`${this.apiUrl}/api/file/${this.currentDownloadId}`);

                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `video_${this.currentDownloadId}`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);

                        this.showToast('File download started!', 'success');
                    } else {
                        throw new Error('Failed to download file');
                    }
                } catch (error) {
                    this.showToast(`Download error: ${error.message}`, 'error');
                }
            }

            setLoadingState(button, loading) {
                if (loading) {
                    button.disabled = true;
                    button.innerHTML = '<div class="spinner"></div> Loading...';
                } else {
                    button.disabled = false;
                    button.innerHTML = button.id === 'getInfoBtn' ?
                        '<i class="fas fa-info-circle"></i> Get Video Info' :
                        '<i class="fas fa-download"></i> Start Download';
                }
            }

            formatDuration(seconds) {
                if (!seconds) return '0:00';
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;

                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }

            formatNumber(num) {
                if (!num) return '0';
                return num.toLocaleString();
            }

            formatDate(dateString) {
                if (!dateString) return 'Unknown';
                const year = dateString.substr(0, 4);
                const month = dateString.substr(4, 2);
                const day = dateString.substr(6, 2);
                return `${month}/${day}/${year}`;
            }

            formatBytes(bytes) {
                if (!bytes) return '0 B';
                const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return `${(bytes / Math.pow(1024, i)).toFixed(1)} ${sizes[i]}`;
            }

            formatTime(seconds) {
                if (!seconds) return '0s';
                if (seconds < 60) return `${Math.round(seconds)}s`;
                const minutes = Math.floor(seconds / 60);
                const secs = Math.round(seconds % 60);
                return `${minutes}m ${secs}s`;
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new YouTubeDownloader();
        });

        // PWA Support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(registrationError => console.log('SW registration failed'));
            });
        }
    </script>
</body>

</html>